# Python Chess Engine and AI

## Overview

This project is a complete chess game and accompanying AI developed from scratch using Python. The goal was to build both a fully functional chess engine that adheres to all standard rules and different AI opponents, including a classic search-based AI and an experimental machine learning-based AI.

---

## Features

### Phase 1: Chess Engine & UI

* **Complete Rule Implementation:** Enforces all legal moves for every piece according to FIDE rules.
* **Special Moves:** Correctly handles Castling, En Passant, and Pawn Promotion.
* **Game State Logic:** Accurately detects Check, Checkmate, and Stalemate.
* **Draw Conditions:** Implements draw detection for Threefold Repetition, the Fifty-Move Rule, and Insufficient Material.
* **Graphical User Interface (GUI):** Built with Pygame, featuring:
    * Visual chessboard and piece rendering.
    * Move highlighting (selected piece and valid moves).
    * Check highlighting (king turns red).
    * Click-click and Drag-and-Drop piece movement.
    * Promotion choice menu.
    * Side panel displaying move log (scrollable), captured pieces with counts, and material difference.
    * Chess clocks with configurable time controls (minutes + increment).
* **Application States:** Includes a main menu (PvP, PvAI Classic, PvAI ML), game over screen, and a "Return to Menu" option during gameplay.
* **Undo Move:** Allows undoing the last move made.

### Phase 2: AI Opponents

Two distinct AI opponents are available:

1.  **Classic AI:**
    * Uses the **Minimax** search algorithm with **Alpha-Beta Pruning** for efficiency.
    * Features a handcrafted **evaluation function** considering:
        * Material count.
        * Piece-Square Tables for positional awareness (center control, development, king safety).
    * Configurable search depth (currently set in `ai.py`).

2.  **Machine Learning (ML) AI:**
    * Also uses **Minimax with Alpha-Beta Pruning** for searching.
    * Replaces the handcrafted evaluation function with a **Convolutional Neural Network (CNN)** trained using **PyTorch**.
    * The CNN was trained on a dataset generated by evaluating positions from Grandmaster games using the **Stockfish** engine.
    * **Note:** The performance depends heavily on the quality and duration of the model training process, current model is trained with the games(~22.000 games) downloaded from [PGN Mentor](https://www.pgnmentor.com/).

---

## Technologies Used

* **Python 3:** Core programming language.
* **Pygame:** For the graphical user interface, rendering, and event handling.
* **PyTorch:** For building and training the Convolutional Neural Network (ML AI).
* **python-chess:** Used in the data preprocessing phase (Colab) to parse PGN files.
* **Stockfish:** Used via the `stockfish` Python package in the data preprocessing phase (Colab) to generate evaluation labels for the ML model.
* **Google Colab:** Used for the computationally intensive tasks of data preprocessing (with Stockfish) and model training (with GPU acceleration).

---

## Setup and Running

1.  **Clone the repository:**
    ```bash
    git clone <your-repo-url>
    cd <your-repo-directory>
    ```
2.  **Install dependencies:**
    ```bash
    pip install pygame torch stockfish python-chess # python-chess only needed if re-running data prep
    # You might also need to install the Stockfish engine binary
    # On Debian/Ubuntu: sudo apt-get update && sudo apt-get install stockfish
    # On macOS (Homebrew): brew install stockfish
    # Or download from [https://stockfishchess.org/download/](https://stockfishchess.org/download/)
    ```
3.  **Download Trained Model (Optional for ML AI):**
    * Place the trained `stockfish_chess_model.pth` file (generated from Colab) into the main project directory. If the file is missing or PyTorch isn't installed, the ML AI option will fall back to the Classic AI.
4.  **Run the game:**
    ```bash
    python main.py
    ```
5.  **Use the Menu:** Select your desired opponent (Human, AI Classic, AI ML) and set the time controls.

---

## File Structure

* `main.py`: Main application file, handles Pygame window, game loop, UI drawing, event handling, and application states (menu, playing, game over).
* `engine.py`: Contains the `GameState` class (board representation, move logic, rules), `Piece` class, `Move` class, and `CastleRights` class. The "Rulebook" of the game.
* `ai.py`: Contains the AI logic, including `find_best_move`, `minimax_pruning`, evaluation functions (`evaluate_board_classic`, `evaluate_board_ML`), piece-square tables, and ML model loading/inference (`ChessCNN`, `vectorize_board`).
* `images/`: Folder containing PNG images for the chess pieces.
* `stockfish_chess_model.pth`: (Optional) The trained PyTorch model file for the ML AI.
* *(Colab Notebooks - Inside the \ai-train)*: Separate notebooks (`chess_data_pp.ipynb`, `chess_model.ipynb`) used for data preprocessing and ML model training.

---

## Known Issues

* Cannot promote pawn with click-click move. (Promotion move happens only with drag move.)
* AI model is performancing very poorly.
* In some cases, queen side castle is not allowed even though it is valid.